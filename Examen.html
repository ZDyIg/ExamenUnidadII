<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title> PARKING JAM 3D </title>
</head>

<body>

    <canvas id="canvas" width="800" height="800"> </canvas>
    <script type="text/javascript">
        const DOC = document.getElementById("canvas");
        const context = DOC.getContext("2d");
        let selectRect = null;

        function getRandomColor() {
            var trans = '0.5'; // 50% transparency
            var color = 'rgba(';
            for (var i = 0; i < 3; i++) {
                color += Math.floor(Math.random() * 255) + ',';
            }
            color += trans + ')'; // add the transparency
            return color;
        }


        // const sellSize = {
        //     x: 100,
        //     y: 100,
        //     width: 400,
        //     height: 400,
        //     exitX: 350,
        //     exitY: 500,
        //     exitWidth: 50,
        //     exitHeight: 50

        // };

        //RECTANGULOS 
        let rectangles = [];

        for (let i = 0; i < 5; i++) {
            rectangles.push({
                x: Math.random() * (canvas.width - 70),
                y: Math.random() * (canvas.height - 40),

                width: 70,
                height: 40,
                color: getRandomColor(),
                //velocidades
                speedX: 5,
                speedY: 5,
            });
        }

        // function drawParking() {
        //     context.strokeStyle = "black";
        //     context.lineWidth = 3;
        //     context.strokeRect(sellSize.x, sellSize.y, sellSize.width, sellSize.height);

        //     context.clearRect(sellSize.exitX, sellSize.exitY, sellSize.exitWidth, sellSize.exitHeight);
        //     context.strokeStyle = "red"; // Para mostrar el borde de la salida
        //     context.strokeRect(sellSize.exitX, sellSize.exitY, sellSize.exitWidth, sellSize.exitHeight);
        // }

        function drawRectangles() {
            console.log();
            context.clearRect(0, 0, canvas.width, canvas.height);
            rectangles.forEach(rect => {
                // if (rect.x >= sellSize.x &&
                //     rect.x + rect.width <= sellSize.x + sellSize.width &&
                //     rect.y >= sellSize.y &&
                //     rect.y + rect.height <= sellSize.y + sellSize.height
                // ) {
                    context.fillStyle = rect.color;
                    context.fillRect(rect.x, rect.y, rect.width, rect.height);
                    //borde negro para selecciòn
                    if (rect === selectRect) {
                        context.strokeStyle = 'black';
                        context.lineWidth = 6;
                        context.strokeRect(rect.x, rect.y, rect.width, rect.height);
                    }
            });
        }

        // function drawScenery() {
        //     context.clearRect(0, 0, canvas.width, canvas.height); // Limpiar canvas
        //     drawParking(); // Dibuja el estacionamiento
        //     drawRectangles(); // Dibuja los rectángulos
        // }

        canvas.addEventListener('click', function (event) {
            console.log();
            const mouseX = event.offsetX;
            const mouseY = event.offsetY;

            selectRect = null;
            rectangles.forEach(rect => {
                if (
                    mouseX >= rect.x &&
                    mouseX <= rect.x + rect.width &&
                    mouseY >= rect.y &&
                    mouseY <= rect.y + rect.height
                ) {
                    selectRect = rect;
                }
            });

            drawRectangles();

        });

        function isColliding(rect1, rect2) {
            return rect1.x < rect2.x + rect2.width &&
                rect1.x + rect1.width > rect2.x &&
                rect1.y < rect2.y + rect2.height &&
                rect1.y + rect1.height > rect2.y;
        }

        //MOVER CON TECLAS
        document.addEventListener('keydown', function (event) {
            if (selectRect) {
                let originalX = selectRect.x;
                let originalY = selectRect.y;

                let colidedX = false;
                let colidedY = false;
                switch (event.key) {
                    case 'ArrowRight':
                        selectRect.x += selectRect.speedX;
                        break;
                    case 'ArrowLeft':
                        selectRect.x -= selectRect.speedX;
                        break;
                    case 'ArrowUp':
                        selectRect.y -= selectRect.speedY;
                        break;
                    case 'ArrowDown':
                        selectRect.y += selectRect.speedY;
                        break;
                    case ' ':
                        const temp = selectRect.width;
                        selectRect.width = selectRect.height;
                        selectRect.height = temp;
                        break;
                    default:
                        break;
                }

                rectangles.forEach(rect => {
                    if (rect !== selectRect) {

                        if (isColliding(selectRect, rect)) {
                            if (selectRect.x !== originalX) {
                                colidedX = true;
                            }
                            if (selectRect.y !== originalY) {
                                colidedY = true;
                            }

                        }

                    }

                });

                if (colidedX) {
                    selectRect.x = originalX;
                }

                if (colidedY) {
                    selectRect.y = originalY;
                }

                drawRectangles();
            }


        });



        drawRectangles();






    </script>


    <style type="text/css">
        body {
            background-color: #e0e0e0;
            font-family: 'Arial', sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
        }

        canvas {
            background-color: #ffffff;
            border: 5px solid #333;
            box-shadow: 0px 4px 10px rgba(0, 0, 0, 0.3);
            border-radius: 15px;
        }

        /*Estilo para el contenedor*/
        .canvas-container {
            padding: 20px;
            background-color: #f9f9f9;
            border-radius: 20px;
            box-shadow: 0px 4px 15px rgba(0, 0, 0, 0.1);
            display: inline-block;
        }
    </style>

</body>

</html>